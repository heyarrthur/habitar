<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>HABItar • Equipe</title>

  <!-- Vendors -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --brand:#22c55e; --brand-600:#16a34a; --brand-50:#ecfdf3;
      --bg:#f6f7f9; --surface:#fff; --border:#e9ecf1; --muted:#98a2b3; --text:#0f172a;
      --radius:18px; --shadow:0 12px 30px rgba(2,8,23,.08);
      --sidebar-w:280px; --sidebar-w-mini:92px;
      --tap:46px;
    }

    *{box-sizing:border-box}
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    a{text-decoration:none}

    .sidebar{
      position:fixed; inset:0 auto 0 0; width:var(--sidebar-w);
      background:var(--surface); border-right:1px solid var(--border);
      padding:18px 14px; display:flex; flex-direction:column; gap:8px; z-index:1030;
    }
    .brand{font-weight:900; display:flex; align-items:center; gap:10px; font-size:1.25rem; padding:6px 8px; border-radius:12px}
    .brand .dot{width:10px;height:10px;border-radius:999px;background:var(--brand);box-shadow:0 0 0 6px rgba(34,197,94,.18)}
    .divider{height:1px;background:var(--border);margin:10px 0}
    .nav-subtitle{text-transform:uppercase; letter-spacing:.08em; font-size:.72rem; color:var(--muted); margin:6px 0 4px; padding:0 6px}
    .nav-link-custom{
      border-radius:12px; padding:10px 12px; color:var(--text); font-weight:600;
      display:flex; align-items:center; gap:12px;
      transition:transform .18s, background-color .25s, box-shadow .25s;
    }
    .nav-link-custom:hover{ background:var(--brand-50); transform:translateX(2px); box-shadow:inset 0 0 0 1px rgba(34,197,94,.25) }
    .nav-link-custom.active{ background:linear-gradient(135deg, rgba(34,197,94,.12), rgba(34,197,94,.04)); box-shadow:inset 0 0 0 1px rgba(34,197,94,.28) }

    .sidebar.mini{ width:var(--sidebar-w-mini); align-items:center }
    .sidebar.mini .label,
    .sidebar.mini .nav-subtitle,
    .sidebar.mini .divider,
    .sidebar.mini #collapseNav .label{ display:none!important }
    .sidebar.mini .brand-text{ display:none!important }
    .sidebar.mini .nav-link-custom{ justify-content:center; padding:10px }

    .content{ margin-left:var(--sidebar-w); min-height:100vh; padding:26px 24px }
    .sidebar.mini ~ .content{ margin-left:var(--sidebar-w-mini) }

    .card-soft{ background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow) }
    .btn-brand{ background:var(--brand); color:#fff; border:none; border-radius:12px; padding:.625rem 1rem; min-height:var(--tap) }
    .btn-brand:hover{ background:var(--brand-600) }
    .table>thead th{ white-space:nowrap }

    @media (min-width:820px) and (max-width:1280px){
      :root{ --sidebar-w:260px; --sidebar-w-mini:88px }
      .content{ padding:22px }
      .nav-link-custom{ padding:12px 12px }
    }
    @media (max-width: 992px){
      .sidebar{ position:sticky; top:0; width:100%; border-right:none; border-bottom:1px solid var(--border); flex-direction:row; align-items:center; gap:12px; overflow:auto }
      .content{ margin-left:0; padding:18px }
      .nav-subtitle{ display:none }
    }

    .btn, .form-control, .form-select{ min-height:var(--tap) }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="brand"><span class="dot"></span> <span class="brand-text">HABItar</span></div>
    <div class="divider"></div>

    <div class="nav-subtitle">Geral</div>
    <a class="nav-link-custom" href="./dashboard.html">
      <i class="bi bi-speedometer"></i> <span class="label">Dashboard</span>
    </a>
    <a class="nav-link-custom active" href="./index.html">
      <i class="bi bi-people"></i> <span class="label">Equipe</span>
    </a>

    <div class="nav-subtitle mt-2">Clientes</div>
    <a class="nav-link-custom" href="./clientes-gerenciar.html">
      <i class="bi bi-person-lines-fill"></i> <span class="label">Gerenciar</span>
    </a>

    <div class="nav-subtitle mt-2">Obras</div>
    <a class="nav-link-custom" href="./obras-gerenciar.html">
      <i class="bi bi-hammer"></i> <span class="label">Gerenciar</span>
    </a>
    <a class="nav-link-custom" href="./gerar-orcamento.html">
      <i class="bi bi-receipt"></i> <span class="label">Gerar Orçamento</span>
    </a>

    <div class="nav-subtitle mt-2">Financeiro</div>
    <a class="nav-link-custom" href="./financeiro-faturamento.html">
      <i class="bi bi-cash-coin"></i> <span class="label">Faturamento</span>
    </a>
    <a class="nav-link-custom" href="./financeiro-estatisticas.html">
      <i class="bi bi-graph-up-arrow"></i> <span class="label">Estatísticas</span>
    </a>

    <div class="divider"></div>
    <a class="nav-link-custom" href="#" id="collapseNav">
      <i class="bi bi-chevron-left"></i> <span class="label">Recolher navbar</span>
    </a>
  </aside>

  <!-- CONTEÚDO -->
  <main class="content">
    <!-- Header (responsivo via utilitários) -->
    <header class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2 gap-md-3 mb-3">
      <div class="text-center text-md-start">
        <h1 class="h4 mb-1">Equipe</h1>
        <div class="text-muted">Gerencie sua equipe e permissões.</div>
      </div>
      <div class="d-flex flex-wrap gap-2 justify-content-start justify-content-md-end">
        <button class="btn btn-outline-secondary" id="btnFilter"><i class="bi bi-funnel"></i> Filtrar</button>
        <button class="btn btn-brand" id="btnAdd"><i class="bi bi-person-plus"></i> Adicionar</button>
      </div>
    </header>

    <!-- KPIs -->
    <section class="row g-3 mb-3">
      <div class="col-12 col-md-4">
        <div class="card-soft">
          <div class="text-muted small">Membros ativos</div>
          <div class="fs-3 fw-bold" id="kActive">0</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card-soft">
          <div class="text-muted small">Membros inativos</div>
          <div class="fs-3 fw-bold" id="kInactive">0</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card-soft">
          <div class="text-muted small">Total</div>
          <div class="fs-3 fw-bold" id="kTotal">0</div>
        </div>
      </div>
    </section>

    <!-- Filtros + Tabela -->
    <section class="card-soft">
      <div class="row g-2 align-items-end mb-2">
        <div class="col-12 col-md-4">
          <label class="form-label">Buscar</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input id="q" class="form-control" placeholder="Nome, cargo..."/>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label">Status</label>
          <select id="status" class="form-select">
            <option value="">Todos</option>
            <option>Ativo</option>
            <option>Inativo</option>
          </select>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label">Cargo</label>
          <input id="role" class="form-control" placeholder="Cargo"/>
        </div>
        <div class="col-12 col-md-2 d-grid">
          <button id="apply" class="btn btn-outline-primary"><i class="bi bi-funnel"></i></button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Nome</th>
              <th class="d-none d-sm-table-cell">Cargo</th>
              <th class="d-none d-md-table-cell">Admissão</th>
              <th>Status</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody id="tb">
            <tr><td colspan="5" class="text-muted text-center py-3">Nenhum membro</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modal Novo/Editar Membro -->
  <div class="modal fade" id="mUser" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="mUserTitle">Adicionar membro</h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <form id="fUser" class="needs-validation" novalidate>
          <div class="modal-body">
            <div class="text-muted mb-1">Dados Pessoais</div>
            <div class="row g-2 mb-2">
              <div class="col-md-6">
                <label class="form-label">Nome</label>
                <input id="firstName" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Sobrenome</label>
                <input id="lastName" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Data de Nascimento</label>
                <input id="birth" type="date" class="form-control">
              </div>
              <div class="col-md-6">
                <label class="form-label">Telefone</label>
                <input id="phone" class="form-control">
              </div>
              <div class="col-md-6">
                <label class="form-label">Cargo</label>
                <input id="job" class="form-control">
              </div>
            </div>

            <div class="text-muted mb-1 mt-2">Dados de Contato</div>
            <div class="row g-2">
              <div class="col-md-6">
                <label class="form-label">E-mail</label>
                <input id="email" type="email" class="form-control">
              </div>
              <div class="col-md-6">
                <label class="form-label">Telefone</label>
                <input id="phone2" class="form-control">
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button class="btn btn-brand" type="submit">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function(){
      const sidebar = document.getElementById('sidebar');
      document.getElementById('collapseNav').addEventListener('click', (e)=>{
        e.preventDefault();
        sidebar.classList.toggle('mini');
      });

      const state = { rows: [], editingId: null };

      const tb = document.getElementById('tb');
      const f = (id)=>document.getElementById(id);
      const dateBR = (d)=> d ? new Date(d).toLocaleDateString('pt-BR') : '—';

      function renderKPIs(){
        const total = state.rows.length;
        const act = state.rows.filter(r=>r.status==='Ativo').length;
        const ina = total - act;
        f('kActive').textContent = act;
        f('kInactive').textContent = ina;
        f('kTotal').textContent = total;
      }

      function renderTable(){
        const q = f('q').value.trim().toLowerCase();
        const st = f('status').value;
        const role = f('role').value.trim().toLowerCase();

        const data = state.rows.filter(r=>{
          const okQ = !q || (r.nome+' '+(r.cargo||'')).toLowerCase().includes(q);
          const okS = !st || r.status===st;
          const okR = !role || (r.cargo||'').toLowerCase().includes(role);
          return okQ && okS && okR;
        });

        tb.innerHTML = '';
        if(!data.length){
          tb.innerHTML = '<tr><td colspan="5" class="text-muted text-center py-3">Nenhum membro</td></tr>';
          return;
        }

        data.forEach(r=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${r.nome}</td>
            <td class="d-none d-sm-table-cell">${r.cargo||'—'}</td>
            <td class="d-none d-md-table-cell">${dateBR(r.admissaoISO)}</td>
            <td>
              <span class="badge ${r.status==='Ativo'?'text-bg-success':'text-bg-secondary'}">${r.status}</span>
            </td>
            <td class="text-end">
              <div class="btn-group">
                <button class="btn btn-sm btn-outline-secondary" data-act="edit"><i class="bi bi-pencil"></i></button>
                <button class="btn btn-sm btn-outline-danger" data-act="del"><i class="bi bi-trash"></i></button>
              </div>
            </td>
          `;
          tr.querySelector('[data-act="edit"]').addEventListener('click', ()=> openEdit(r.id));
          tr.querySelector('[data-act="del"]').addEventListener('click', ()=>{
            if(confirm('Deseja remover este membro?')){
              state.rows = state.rows.filter(x=>x.id!==r.id);
              renderKPIs(); renderTable();
            }
          });
          tb.appendChild(tr);
        });
      }

      // Handlers de filtro
      f('apply').addEventListener('click', renderTable);
      f('q').addEventListener('input', renderTable);
      f('status').addEventListener('change', renderTable);
      f('role').addEventListener('input', renderTable);

      const modal = new bootstrap.Modal('#mUser');
      document.getElementById('btnAdd').addEventListener('click', ()=>{
        state.editingId = null;
        f('mUserTitle').textContent = 'Adicionar membro';
        f('firstName').value = '';
        f('lastName').value = '';
        f('birth').value = '';
        f('phone').value = '';
        f('job').value = '';
        f('email').value = '';
        f('phone2').value = '';
        modal.show();
      });

      function openEdit(id){
        const r = state.rows.find(x=>x.id===id);
        if(!r) return;
        state.editingId = id;
        f('mUserTitle').textContent = 'Editar membro';
        const [firstName,...rest] = r.nome.split(' ');
        f('firstName').value = firstName||'';
        f('lastName').value = rest.join(' ')||'';
        f('birth').value = r.birth||'';
        f('phone').value = r.phone||'';
        f('job').value = r.cargo||'';
        f('email').value = r.email||'';
        f('phone2').value = r.phone2||'';
        modal.show();
      }

      document.getElementById('fUser').addEventListener('submit', function(e){
        e.preventDefault();

        const nome = (f('firstName').value.trim() + ' ' + f('lastName').value.trim()).trim() || 'Sem nome';
        const cargo = f('job').value.trim() || '';
        const birth = f('birth').value || '';
        const phone = f('phone').value.trim() || '';
        const email = f('email').value.trim() || '';
        const phone2 = f('phone2').value.trim() || '';

        if(state.editingId){
          const idx = state.rows.findIndex(x=>x.id===state.editingId);
          if(idx>-1){
            const prev = state.rows[idx];
            state.rows[idx] = { ...prev, nome, cargo, birth, phone, email, phone2 };
          }
        }else{
          state.rows.push({
            id: crypto.randomUUID(),
            nome, cargo,
            admissaoISO: new Date().toISOString(),
            status: 'Ativo',
            birth, phone, email, phone2
          });
        }

        renderKPIs(); renderTable();
        modal.hide();
      });

      renderKPIs();
      renderTable();
    })();
  </script>
</body>
</html>
